# Автоматическая кормушка для кошек на базе Arduino (GyverFeed2)

## Описание

Этот проект представляет собой автоматическую кормушку для домашних животных (в частности, для кошек), реализованную на базе микроконтроллера Arduino. Кормушка позволяет программировать расписание кормления, автоматически выдавая порции корма в заданное время. Проект основан на библиотеке GyverFeed2 от AlexGyver, которая упрощает управление сервоприводами и кнопками для автоматизации процесса.

Проект был дополнен модулем ESP32 с поддержкой WiFi, что позволяет удаленно управлять кормлением через интернет. Теперь кормушка интегрируется с голосовым ассистентом Яндекс Алиса, enabling голосовое управление (например, команды вроде "Алиса, покорми кошку"). Это добавляет удобство для удаленного мониторинга и контроля.

Проект разработан для простоты сборки и использования, подходит для начинающих энтузиастов электроники. Он использует минимальный набор компонентов и поддерживает настройку через кнопки, серийный монитор или мобильное приложение/голосовой ассистент.

**Версия:** v2.2 (обновлено для совместимости с актуальными версиями библиотек EncButton и microDS3231; добавлена поддержка ESP32 WiFi и Яндекс Алисы).

## Особенности

- **Автоматическое кормление по расписанию:** Поддержка нескольких кормлений в день с использованием RTC-модуля (Real-Time Clock) для точного времени.
- **Ручное управление:** Кнопки для ручного выдачи корма и настройки времени.
- **Индикация:** LED-индикаторы или дисплей (в зависимости от конфигурации) для отображения статуса.
- **Энергосбережение:** Низкое потребление энергии, подходит для работы от батареек или адаптера.
- **Простая сборка:** Использует стандартные компоненты Arduino, такие как сервопривод для подачи корма.
- **Обновленные библиотеки:** Адаптировано под свежие версии EncButton (для обработки кнопок) и microDS3231 (для RTC DS3231).
- **WiFi и удаленное управление:** Благодаря ESP32, кормушка подключается к WiFi-сети для удаленного доступа.
- **Интеграция с Яндекс Алисой:** Голосовое управление кормлением через навык в Яндекс Диалогах.

## Требуемые компоненты

- **Микроконтроллер:** ESP32 (рекомендуется вместо Arduino Uno/Nano для WiFi-функций; совместим с Arduino IDE).
- **Сервопривод:** SG90 или аналогичный (для механизма подачи корма).
- **RTC-модуль:** DS3231 для поддержания времени.
- **Кнопки:** 2-3 тактовые кнопки для управления (вкл/выкл, ручное кормление, установка времени).
- **Дисплей (опционально):** LCD 16x2 или OLED для отображения времени и статуса.
- **Корпус и контейнер:** 3D-печатный или самодельный корпус для корма и механизма.
- **Питание:** 5V адаптер или USB.
- **Дополнительно:** Резисторы, провода, breadboard для прототипа; WiFi-роутер для сетевого подключения.

## Зависимости и библиотеки

Проект использует следующие библиотеки Arduino (устанавливаются через Library Manager в IDE):

- **GyverFeed2** (автор: AlexGyver) — основная библиотека для управления кормушкой.
- **EncButton** (автор: AlexGyver) — для обработки нажатий кнопок без задержек.
- **microDS3231** (автор: Fozbix) — для работы с RTC DS3231.
- **Servo** (стандартная) — для управления сервоприводом.
- **Wire** (стандартная) — для I2C-связи с RTC и дисплеем.
- **WiFi** (для ESP32) — для подключения к WiFi-сети.
- **ESPAsyncWebServer** или **AsyncTCP** (для создания веб-сервера на ESP32).
- **HTTPClient** — для обработки запросов от Яндекс Алисы (если требуется).

Убедитесь, что версии библиотек обновлены до последних (на момент v2.2: EncButton >= 1.0, microDS3231 >= 1.0).

## Схема подключения

(Здесь должна быть схема подключения. Рекомендуется использовать Fritzing или аналогичный инструмент для визуализации.)

Примерная схема (адаптирована для ESP32):

- **Сервопривод (SG90):**
  - Красный (VCC) → 3.3V/5V (в зависимости от модели ESP32)
  - Коричневый (GND) → GND
  - Оранжевый (сигнал) → GPIO 9 (или другой PWM-pin)

- **RTC DS3231:**
  - VCC → 3.3V
  - GND → GND
  - SDA → GPIO 21 (стандартный I2C на ESP32)
  - SCL → GPIO 22

- **Кнопки:**
  - Кнопка 1 (ручное кормление) → GPIO 2 → GND (с подтяжкой)

**!! Для ESP32 убедитесь в совместимости напряжений (3.3V логика).**

## Установка и сборка

1. **Сборка аппаратной части:**
   - Соберите схему на breadboard или PCB по описанию выше.
   - Установите сервопривод в механизм подачи корма (например, поворот лопатки для выдачи порции).
   - Поместите в корпус, обеспечьте доступ к кнопкам и контейнеру для корма.

2. **Установка библиотек:**
   - Откройте Arduino IDE.
   - Перейдите в `Sketch > Include Library > Manage Libraries`.
   - Найдите и установите: GyverFeed2, EncButton, microDS3231, WiFi (для ESP32), ESPAsyncWebServer.

3. **Загрузка кода:**
   - Клонируйте репозиторий: `git clone https://github.com/pkambur/automatic_cat-feede_-on_base_GyverFeed2.git`
   - Откройте файл `GyverFeed2.ino` в Arduino IDE.
   - Выберите плату (Tools > Board > ESP32 Dev Module) и порт.
   - Загрузите скетч на устройство.

4. **Первоначальная настройка:**
   - Подключите ESP32 к компьютеру по USB.
   - Откройте Serial Monitor (9600 baud) для отладки.
   - Установите время на RTC с помощью кнопок или через код (см. пример в скетче).
   - Настройте расписание кормления (по умолчанию: 8:00, 12:00, 18:00, 22:00).

## Настройка WiFi и Интеграции с Яндекс Алисой

1. **Подключение к WiFi:**
   - В коде укажите SSID и пароль вашей WiFi-сети:
     ```
     const char* ssid = "Ваша_SSID";
     const char* password = "Ваш_пароль";
     ```
   - В функции setup() добавьте:
     ```
     WiFi.begin(ssid, password);
     while (WiFi.status() != WL_CONNECTED) {
       delay(1000);
       Serial.println("Подключение к WiFi...");
     }
     Serial.println("Подключено! IP: " + WiFi.localIP().toString());
     ```
   - Перезагрузите устройство. В Serial Monitor увидите локальный IP-адрес (например, 192.168.1.100).

2. **Настройка веб-сервера на ESP32:**
   - Установите библиотеку ESPAsyncWebServer.
   - Добавьте в код сервер для обработки запросов:
     ```
     #include <ESPAsyncWebServer.h>
     AsyncWebServer server(80);

     void setup() {
       // ... (другие настройки)
       server.on("/feed", HTTP_GET, [](AsyncWebServerRequest *request){
         // Код для выдачи корма
         feedCat();  // Ваша функция кормления
         request->send(200, "text/plain", "Корм выдан!");
       });
       server.begin();
     }
     ```
   - Теперь по адресу http://<IP>/feed можно вызвать кормление.

3. **Интеграция с Яндекс Алисой:**
   - Создайте аккаунт разработчика в Яндекс Диалогах (https://dialogs.yandex.ru/developer/).
   - Создайте новый навык (Skill) типа "Умный дом" или "Простой навык".
   - В навыке добавьте интенты для команд, например:
     - "Покорми кошку" → Отправить HTTP-запрос на http://<Ваш_IP>/feed.
   - Для внешнего доступа (если не в локальной сети):
     - Используйте NGROK или Port Forwarding на роутере для получения публичного URL.
     - Альтернативно, настройте DDNS (Dynamic DNS) для динамического IP.
   - В навыке укажите webhook URL: https://<публичный_URL>/feed.
   - Активируйте навык в приложении Яндекс или на устройстве с Алисой.
   - Тестируйте: Скажите "Алиса, покорми кошку" — должно выдать порцию корма.

Обратите внимание: Для безопасности добавьте аутентификацию (токен) в запросы. Если устройство в локальной сети, Алиса должна быть в той же сети или использовать VPN.

## Использование

- **Автоматический режим:** Кормушка выдаст порцию корма в заданное время. Сервопривод повернется на 90° (или угол, настроенный в коде) для подачи.
- **Ручное кормление:** Нажмите кнопку 1 — выдаст порцию немедленно. Или используйте веб-интерфейс/Алису.
- **Настройка времени:** Удерживайте кнопку 2 для входа в меню, используйте кнопки для установки часов/минут.
- **Удаленное управление:** Через браузер (http://<IP>/) или Яндекс Алису.
- **Отладка:** В Serial Monitor выводится текущее время, статус кормления, WiFi-соединение и ошибки.

Пример вывода в Serial:
```
Текущее время: 09:15:30
Следующее кормление: 12:00
WiFi подключено: IP 192.168.1.100
```

## Настройка кода

Основной файл: `GyverFeed2.ino`

Ключевые параметры для редактирования:

- `FEED_HOUR[]` — массив часов кормления (int feedHours[] = {8, 12, 18, 22};).
- `SERVO_PIN` — пин сервопривода (const int SERVO_PIN = 9;).
- `FEED_ANGLE` — угол поворота сервопривода (const int FEED_ANGLE = 90;).
- `BUTTON_PINS[]` — пины кнопок.
- WiFi параметры (ssid, password) как выше.

Измените эти значения под вашу конфигурацию и перезагрузите.

Полный код доступен в репозитории. 
Добавлена поддержка MQTT (MQTT брокер).

## Возможные проблемы и решения

- **RTC не держит время:** Проверьте батарейку CR2032 в модуле DS3231.
- **Сервопривод не двигается:** Убедитесь в правильном питании (3.3V/5V для ESP32).
- **Кнопки не реагируют:** Добавьте pull-up резисторы (10kΩ) если не используются внутренние.
- **Ошибки компиляции:** Обновите библиотеки или проверьте версии Arduino IDE (рекомендуется 1.8+ или 2.x).
- **WiFi не подключается:** Проверьте SSID/пароль; ESP32 в пределах сигнала.
- **Алиса не работает:** Убедитесь в правильном webhook; протестируйте запрос curl'ом: `curl http://<IP>/feed`.

## Лицензия

Проект распространяется под лицензией MIT. Вы можете свободно использовать, модифицировать и распространять код.

## Автор и контакты

- Автор: pkambur (Петр Камбур)
- GitHub: [pkambur](https://github.com/pkambur)
- Оригинальный проект: [AlexGyver/GyverFeed](https://github.com/AlexGyver/GyverLibs) (библиотека)

Если у вас есть вопросы или предложения, создайте issue в репозитории.

