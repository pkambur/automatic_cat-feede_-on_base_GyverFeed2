# GyverFeed ESP8266 - Управление через Яндекс Станцию

## Описание

ESP8266 модуль для управления автокормушкой GyverFeed через Яндекс Станцию и голосового помощника Алису. Позволяет дистанционно управлять кормлением питомцев через WiFi.

## Интеграция с проектом [pkambur/automatic_cat-feede_-on_base_GyverFeed2](https://github.com/pkambur/automatic_cat-feede_-on_base_GyverFeed2.git)

- Для интеграции используйте пин **7** на Arduino (`#define ESP_FEED_PIN 7`) и пин **D7 (GPIO13)** на ESP8266 (`#define FEED_PIN 13`).
- Подключите D7 ESP8266 к пину 7 Arduino.
- Все изменения совместимы с основной структурой репозитория pkambur.

## Структура папок

```
firmware/
  ├── arduino/
  │    └── GyverFeed_v2.2.ino
  └── esp8266/
       └── GyverFeed_ESP8266.ino
schemes/
3Dprint/
README.md
README_ESP8266.md
```

## Возможности

- ✅ Подключение к WiFi сети
- ✅ Веб-интерфейс для настройки
- ✅ Интеграция с Яндекс Smart Home API
- ✅ Голосовое управление через Алису
- ✅ Сохранение настроек в EEPROM
- ✅ Индикация состояния через LED
- ✅ Точка доступа для первичной настройки

## Компоненты

- ESP8266 (NodeMCU, Wemos D1 Mini или аналогичный)
- Соединительные провода
- Блок питания 3.3V для ESP8266

## Подключение

### Схема подключения ESP8266 к Arduino

```
ESP8266 (D7/GPIO13) ─────▶ Arduino (D7/пин 7)
3.3V  ─────▶  VCC
GND   ─────▶  GND
```

### Модификация Arduino кода

Добавьте в `GyverFeed_v2.2.ino` следующий код для обработки сигнала от ESP8266:

```cpp
#define ESP_FEED_PIN 7  // Пин для сигнала от ESP8266

void setup() {
  // ...
  pinMode(ESP_FEED_PIN, INPUT_PULLUP);
  // ...
}

void loop() {
  // ...
  if (digitalRead(ESP_FEED_PIN) == LOW) {
    feed();
    delay(1000);  // Задержка для избежания повторного срабатывания
  }
  // ...
}
```

## Настройка

### 1. Установка библиотек

В Arduino IDE установите следующие библиотеки:
- ESP8266WiFi
- ESP8266WebServer  
- ESP8266HTTPClient
- ArduinoJson (версия 6.x)

### 2. Первичная настройка

1. Загрузите код `GyverFeed_ESP8266.ino` в ESP8266
2. Откройте Serial Monitor (115200 baud)
3. ESP8266 создаст точку доступа `GyverFeed_Setup` с паролем `12345678`
4. Подключитесь к этой сети WiFi
5. Откройте браузер и перейдите по адресу `192.168.4.1`
6. Заполните настройки WiFi и сохраните

### 3. Настройка Яндекс Smart Home

#### Получение токена Яндекс Smart Home:

1. Перейдите на [Yandex Smart Home Developer Console](https://yandex.ru/dev/dialogs/alice/doc/smart-home/concepts/about-docpage/)
2. Создайте новый навык
3. Получите токен для API
4. Введите токен в веб-интерфейсе ESP8266

#### Регистрация устройства:

1. В приложении "Дом с Алисой" добавьте новое устройство
2. Выберите тип "Умное устройство"
3. Укажите IP-адрес ESP8266 в локальной сети
4. Устройство появится в списке доступных

## Использование

### Голосовые команды для Алисы:

- "Алиса, включи автокормушку" - запуск кормления
- "Алиса, выключи автокормушку" - остановка кормления
- "Алиса, покорми питомца" - запуск кормления
- "Алиса, статус автокормушки" - проверка состояния

### Веб-интерфейс:

- Откройте IP-адрес ESP8266 в браузере
- Используйте кнопку "Покормить сейчас" для ручного управления
- Настройте параметры кормления

## API Endpoints

ESP8266 предоставляет следующие API endpoints:

- `GET /` - Веб-интерфейс настроек
- `POST /save` - Сохранение настроек
- `POST /feed` - Запуск кормления
- `POST /restart` - Перезагрузка устройства
- `POST /yandex/discovery` - Discovery для Яндекс Smart Home
- `POST /yandex/query` - Query для Яндекс Smart Home  
- `POST /yandex/action` - Action для Яндекс Smart Home

## Индикация

- **LED выключен** - устройство не подключено к WiFi
- **LED мигает каждые 2 секунды** - подключено к WiFi
- **LED быстро мигает** - идет процесс кормления

## Устранение неполадок

### ESP8266 не подключается к WiFi:
1. Проверьте правильность SSID и пароля
2. Убедитесь, что сеть работает на частоте 2.4 ГГц
3. Попробуйте перезагрузить ESP8266

### Алиса не видит устройство:
1. Проверьте, что ESP8266 подключен к той же сети WiFi
2. Убедитесь, что токен Яндекс Smart Home введен правильно
3. Проверьте, что устройство зарегистрировано в приложении

### Кормление не запускается:
1. Проверьте подключение провода между ESP8266 и Arduino
2. Убедитесь, что Arduino получает сигнал (проверьте Serial Monitor)
3. Проверьте, что мотор подключен правильно

## Безопасность

- Измените пароль точки доступа в коде
- Используйте HTTPS для веб-интерфейса (опционально)
- Регулярно обновляйте прошивку ESP8266
- Не передавайте токены третьим лицам

## Лицензия

MIT License - см. файл LICENSE в корне проекта.

## Поддержка

При возникновении проблем:
1. Проверьте Serial Monitor для диагностики
2. Убедитесь в правильности подключения
3. Проверьте настройки WiFi и Яндекс Smart Home
4. Обратитесь к документации ESP8266 и Яндекс Smart Home API 